<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="{% block meta_description %}{% endblock %}" />
        <meta name="keywords" content="{% block meta_keywords %}{% endblock %}" />
        {% block noindex %}{% endblock %}
        {% block openGraph %}{% endblock %}
        <link rel="shortcut icon" href="{{ asset('favicon.png') }}" type="image/png">
        <title>{% block title %}{% endblock %}</title>

        {% block stylesheets %}{% endblock %}

        {% set consent = "logilinkLocalCookie" %} <!-- CONSENT Value -->
        <!-- Matomo -->
        <script type="text/javascript">
            var _paq = window._paq = window._paq || [];
            <!-- CODE CNIL OBLIGATOIRE -->
            _paq.push([function() {
                var self = this;
                function getOriginalVisitorCookieTimeout() {
                    var now = new Date(),
                        nowTs = Math.round(now.getTime() / 1000),
                        visitorInfo = self.getVisitorInfo();
                    var createTs = parseInt(visitorInfo[2]);
                    var cookieTimeout = 33696000; // 13 mois en secondes
                    return createTs + cookieTimeout - nowTs;
                }
                this.setVisitorCookieTimeout( getOriginalVisitorCookieTimeout() );
            }]);
            <!-- FIN DU CODE CNIL -->
            /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
            let cookies = document.cookie.split(';');
            let findConsent = false, find = 2;
            cookies.forEach(el => {
                let elem = el.split("=");
                if(elem[0].trim() === "logilinkLocalCookie"){
                    findConsent = true;
                    if(elem[1].trim() === "true"){
                        find = 1;
                    }else if(elem[1].trim() === "false"){
                        find = 0;
                    }
                }
            })
            _paq.push(['requireCookieConsent']);
            if(find === 1){
                _paq.push(['rememberCookieConsentGiven']);
            }else if(find === 0){
                if(findConsent){
                    _paq.push(['disableCookies']);
                }
                _paq.push(['forgetCookieConsentGiven']);
            }
            _paq.push(['trackPageView']);
            _paq.push(['enableLinkTracking']);
            (function() {
                var u="https://matomo.demodirecte.fr/";
                _paq.push(['setTrackerUrl', u+'matomo.php']);
                _paq.push(['setSiteId', '21']);
                var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
                g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
            })();
        </script>
        <!-- End Matomo Code -->
        {% block javascripts %}{% endblock %}
    </head>
<body>

    {% if is_granted('IS_IMPERSONATOR') %}
        <div class="impersonate">
            <a href="{{ impersonation_exit_path(path('admin_users_index') ) }}">
                <span class="icon-eject"></span>
                Quitter l'imitation
            </a>
        </div>
    {% endif %}

    <div id="cookies" data-consent="{{ consent }}"></div>

    <div>
        {# --------------- BODY ---------------- #}
        {% block body %}{% endblock %}
    </div>

</body>
</html>